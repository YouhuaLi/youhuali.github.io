---
title: “凉宫春日的忧郁”有几种看法？-- 超级排列数问题
type: page
parent_id: '0'
published: true
status: publish
key: page.lianggongchunri
categories: 音频讲稿
tags: ["超级排列数", "排列组合"]
author:
  login: webcraft2013
  email: webcraft@gmail.com
  display_name: webcraft2013
  first_name: ''
  last_name: ''

---

大家好，我是大老李。我不久前节目刚介绍过康威悬赏1000美元的4个问题，但还是有听众说太难了。那好，今天我给各位一道比那几题更“简单”，也非常适合业余爱好者研究的一个问题：超级排列数（Super Permutation）问题。

这个问题最近有些热起来是因为它有了些新的进展。这个进展要从2011年的一个帖子说起。话说那年在国外一个动漫二次元爱好者的网站（[4chan](http://www.4chan.org/)）上有人发了这么一个帖子：怎样以最快的速度看完“凉宫春日的忧郁”，并把所有可能的顺序都到？这句话的意思我得解释一下，这个问题不是二次元爱好者还真不好理解。
![enter image description here](https://upload.wikimedia.org/wikipedia/zh/thumb/7/77/Suzumiya_Haruhi_no_Yuutsu_Official_DVD1.jpg/250px-Suzumiya_Haruhi_no_Yuutsu_Official_DVD1.jpg)
（上图：凉宫春日的忧郁DVD封面）

首先“凉宫春日的忧郁”是一部日本动画片，动画片的背景设定里是有时间穿越的，所以这部动画片每一集内容相对独立且时间先后是不确定的。而当初它在电视台重播的时候，重播的集次顺序也是与首播不一样的。

2011年，这部14集动画片发行了DVD，在DVD上看你当然可以直接选择任何一集开始收看。所以就有宅男在论坛上问，如果我想把这部动画片以所有可能顺序看完，那么最快的看法是怎样的，需要看多少集？这确实是很理工男的一个问题。

我可以再稍微举个例子，帮各位分析一下这个问题。比如这部动画片如果只有3集，我们知道3的全排列数是3!=6。也就是总共有6种不同的顺序去看完这部动画片，就是：123，132，213，231，312，321。但我并不需要完整的看完3*6=18集，来看完所有顺序组合。

比如我先按1、2、3的顺序看了3集，接下来我再看第1集，那我看过的顺序就是1231。从最后3集的顺序来看，就等于把231这个顺序也看完了。看过1231之后，如果要节省时间，那显然应该看第2集，这样等于看完了312这种组合。看过12312之后，你会稍微踌躇一下。因为你看过的最后两集是1和2，但是123这种组合你已经看过，所以再看第3集就没意义了。接下来你无法再像之前那样，每次重复利用最后2个数字，你只能再利用1个数字了。

总之，你的目标就是找出一个最短由123组成的数字序列，其中要包含123的所有6种排列顺序。而这种由n个不同符号组成的序列，其中包含有这些符号所有排列顺序的序列要做“超级排列”，其中最短的一种排列方式叫“最小超级排列”，而其长度，叫做n的“最小超级排列数”，或者就简称为n的超级排列数。这个问题理解起来是不是够简单？

而3的最小超级排列相信各位在纸上稍微试试看就能找出来了（例：![](http://tex.s2cms.ru/png/%24123121321%24)），其长度应该是9。找4的超级排列数稍微有点难，但其实在纸上也能试出来，其长度应该是33。要注意找出这些超级排列不难，要证明它们是最短的才是难的。但好在n比较小的时候，我们可以用电脑枚举。  

很早以前就有人用电脑枚举出来，3和4的超级排列数确实是9和33，而5的超级排列数是153。观观察这些数字，你会发现第n个超级排列数减去前一个超级排列数正好是![](http://tex.s2cms.ru/png/%24n%EF%BC%81%24)。比如![](http://tex.s2cms.ru/png/%2433-9%3D24%3D4%21%24)。而![](http://tex.s2cms.ru/png/%24153-33%3D120%3D5%21%24)。而确实有一种比较简单的构造法，可以通过从n-1的超级排列中，增加n！个字符，得到n的超级排列。所以人们就认为n的超级排列数就是![](http://tex.s2cms.ru/png/%241%21%2B2%21%2B3%21%2B....%2Bn%21%24)。比如6的超级排列数人们猜测为![](http://tex.s2cms.ru/png/%24153%2B6%21%3D873%24)。

-----
1到4的最小超级排列及其长度：

| n | 长度 |最小超级排列
|--|--|--|
| 1 | 1 | 1|
| 2 | 3 | 121|
| 3| 9 | 123121321|
| 4| 33 | 123412314231243121342132413214321|

-----
  
而意想不到的的一幕在2014出现了，一个叫Robin Houston的人发表了一篇文章，他用电脑程序找到了一个长度为872的6的超级排列数，比猜想的短了1！这下大家都懵了，这说明之前的猜想完全是错的，现在连6的真正最小的超级排列数是多少也不知道了，因为你不能保证872就是最短的。

----
6的长度为872的超级排列，打破了原先的猜想长度（![](http://tex.s2cms.ru/png/%241%21%2B2%21%2B3%21%2B4%21%2B5%21%2B6%21%3D873%24)）：
>12345612345162345126345123645132645136245136425136452136451234651234156234152634
15236415234615234165234125634125364125346125341625341265341235641235461235416235
41263541236541326543126453162435162431562431652431625431624531642531462531426531
42563142536142531645231465231456231452631452361452316453216453126435126431526431
25643215642315462315426315423615423165423156421356421536241536214536215436215346
21354621345621346521346251346215364215634216534216354216345216342516342156432516
43256143256413256431265432165432615342613542613452613425613426513426153246513246
53124635124631524631254632154632514632541632546132546312456321456324156324516324
56132456312465321465324165324615326415326145326154326514362514365214356214352614
35216435214635214365124361524361254361245361243561243651423561423516423514623514
263514236514326541362541365241356241352641352461352416352413654213654123

----

而Robin Houston用的电脑算法也很简单，其实他把问题转化成了图论中著名的“旅行推销员问题”（Traveling salesman problem），简称TSP问题。比如我们还是考虑3的超级排列数。1到3的全排列有![](http://tex.s2cms.ru/png/%243%21%3D6%24)种。那我就在纸上画6个点，每个点表示其中一种排列。然后我要给这些点两两连线，且做成一个有向图，并且给这些线赋予一个权重，而这个权重就表示如果这两点出现最终超级排列中时，会导致序列增加的长度。

---
**旅行推销员问题**（最短路径问题）（英语：**Traveling salesman problem**, **TSP**）是这样一个问题：给定一系列城市和每对城市之间的距离，求解访问每一座城市一次并回到起始城市的最短回路。它是[组合优化](https://zh.wikipedia.org/wiki/%E7%BB%84%E5%90%88%E4%BC%98%E5%8C%96 "组合优化")中的一个[NP困难](https://zh.wikipedia.org/wiki/NP%E5%9B%B0%E9%9A%BE "NP困难")问题，在[运筹学](https://zh.wikipedia.org/wiki/%E8%BF%90%E7%AD%B9%E5%AD%A6 "运筹学")和[理论计算机科学](https://zh.wikipedia.org/wiki/%E7%90%86%E8%AB%96%E8%A8%88%E7%AE%97%E6%A9%9F%E7%A7%91%E5%AD%B8 "理論計算機科學")中非常重要。

[![](https://upload.wikimedia.org/wikipedia/commons/thumb/1/11/GLPK_solution_of_a_travelling_salesman_problem.svg/220px-GLPK_solution_of_a_travelling_salesman_problem.svg.png)](https://zh.wikipedia.org/wiki/File:GLPK_solution_of_a_travelling_salesman_problem.svg)

旅行商问题的解

TSP是[旅行购买者问题](https://zh.wikipedia.org/w/index.php?title=%E6%97%85%E8%A1%8C%E8%B4%AD%E4%B9%B0%E8%80%85%E9%97%AE%E9%A2%98&action=edit&redlink=1)与[车辆路径问题](https://zh.wikipedia.org/w/index.php?title=%E8%BD%A6%E8%BE%86%E8%B7%AF%E5%BE%84%E9%97%AE%E9%A2%98&action=edit&redlink=1)的一种特殊情况。

在[计算复杂性理论](https://zh.wikipedia.org/wiki/%E8%AE%A1%E7%AE%97%E5%A4%8D%E6%9D%82%E6%80%A7%E7%90%86%E8%AE%BA "计算复杂性理论")中，TSP的做决定版本（其中，给定长度 _L_，任务是决定图中是否有路径比 _L_ 还要短）属于[NP完全](https://zh.wikipedia.org/wiki/NP%E5%AE%8C%E5%85%A8 "NP完全")问题。因此随着城市数量的增多，任何TSP算法[最坏情况下](https://zh.wikipedia.org/wiki/%E8%A8%88%E7%AE%97%E6%99%82%E9%96%93 "計算時間")的[运行时间](https://zh.wikipedia.org/wiki/%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6 "时间复杂度")都有可能随着城市数量的增多超多项式（可能是[指数](https://zh.wikipedia.org/w/index.php?title=%E6%8C%87%E6%95%B0%E6%97%B6%E9%97%B4%E5%81%87%E8%AF%B4&action=edit&redlink=1)）级别增长。

（以上摘自维基百科）

---

比如考虑从“123”这个点到“231”这个点的连线，因为从123序列之后只要再写个1，我就能包含231这个组合，所以这条线的权重就是1。反过来，从231这个点到123这个点，我发现要在231之后再写上2和3两个数字，才能得到231组合，那么这条连线的权重就是2。以此类推，我可以对所有6个点之间的连线都赋予这样的权重。

所有连线权重有了之后，寻找超级排列数的问题就转化为从这个图中找一条“路”，这条路要通过每个点至少一次，且路的权重为最小。而这个问题恰好就是图论中的“旅行推销员”问题。这样太棒了，因为我们已经有很多算法去求解旅行推销员问题。

----
![enter image description here](https://d2r55xnwy6nx47.cloudfront.net/uploads/2018/11/Permutations_560-902x1720.jpg)
(上图：将超级排列数问题转换为“旅行推销员问题"的过程。图片来源：Lucy Reading-Ikkanda/Quanta Magazine)

----  

但不幸的是，旅行推销员问题是所谓“NP完全问题”，求解算法会是非常低效的。实际上那个Robin Houston用了TSP问题算法中的一种“概率”求解算法，也就是算法并不枚举所有情况，他只是设定了一个目标，即我要找到一条长度小于753的路，算法只是尽可能去找最短的路，并且找到这样的路才输出。这样输出的结果并不能保证是最短的路，也不能保证一定时间内有输出，所以叫概率性算法。结果是他很幸运的在不多的时间内就找到一条长752的路。而如果要使用确定性的算法，则一般服务器可能要运行几个月到几年，更别说处理6以上的超级排列数问题了。

但是Houston的这个发现出来之后，一下子引起了众多爱好者的兴趣。因为这个问题看上去是如此简单，但是居然我们现在还没有确切结论。而在这众多爱好者当中，就包括一位澳大利亚的科幻小说作家格雷格·伊根（Greg Egan，1961-，曾获雨果奖）。

![enter image description here](https://upload.wikimedia.org/wikipedia/commons/2/2d/GregEgan.gif)
（上图：Greg Egan在维基百科上留下的图片，申明“网上没有任何我的照片”！）

格雷格·伊根今年57岁，他早年在澳大利亚一所大学数学专业毕业，但爱好写小说，他22岁时发表了第一部科幻小说，后来转为专业小说家，著作颇丰，曾获雨果奖。但他本人从没有放弃对数学的爱好。其实他1994年的一步小说的名字恰好就叫做“排列城（Permutation City）。

 ![enter image description here](http://t1.gstatic.com/images?q=tbn:ANd9GcQvcUb4zFF3PBABKZOBnbV9sqBG2aZYE8aHLVfCqv_BRmUgWBE9)(上图：Greg Egan 1994年的小说作品《排列城》) 
  
不过怎样，这位“澳大利亚的刘慈欣”看到Houston对超级排列数问题的发现后，他很感兴趣，于是开始考虑有没有可能找到比Houston的更短的超级排列。而没有多久，他就找到了一个超级排列数的上限。这个新的上限与原来的有点像。原先的猜想倒过来说是![](http://tex.s2cms.ru/png/%24n%21%2B%28n-1%29%21%2B%28n-2%29%2B...%2B1%21%24)。伊根给出的新上限是![](http://tex.s2cms.ru/png/%24n%21%2B%28n-1%29%21%2B%28n-2%29%21%2B%28n-3%29%21%2B%28n-3%29%24)。你会发现新的上限在n<=6之前会大于等于原来的上限，所以并不优越。但是从n=7开始，这个新的上限比原先的就小多了，所以这是一个新的大进展。  

而伊根用的算法是之前一个叫Araon Willams的人2013年一篇论文里提出的有关从循环群中构建凯莱图的方法构造的。这里再次提到了循环群，所以大家可再一次看到群论的威力。而伊根在他的[个人网站](http://www.gregegan.net/SCIENCE/Superpermutations/Superpermutations.html)上也给出了这种算法的一个C语言程序，你可以用它生成任何符合他得出的那个上限n的超级排列。

![enter image description here](http://www.gregegan.net/SCIENCE/Superpermutations/BP3.png)![enter image description here](http://www.gregegan.net/SCIENCE/Superpermutations/BP4.png)![enter image description here](http://www.gregegan.net/SCIENCE/Superpermutations/BP5.png)（上图：Greg Egan个人网站上有关超级排列数上限证明的说明，将“距离为1”的排列放在一个圆内，两个圆之间的“距离为2”，如此迭代。可以证明最终的“旅行推销员”路只需要经过权重为1和2的路。）  

但有上限，并不说明这个上限就是最短的，我们还得看下限。关于这个下限的问题有点意思，节目开头我说了2011年时候有人在论坛上问了“凉宫春日的忧郁”最快怎么看完的问题。但显然那个论坛一般数学家是完全不会去的，所以也没有人指出这是超级排列数问题。但是有一个人匿名回复了一下关于这个问题的下限，这个下限跟之前伊根的上限很像：![](http://tex.s2cms.ru/png/%24n%21%2B%28n-1%29%21%2B%28n-2%29%21%2B%28n-3%29%24)。这位匿名大侠的回复只是很阐述了一下他的思路，并没有严格证明。

幸而不久后，加拿大一所大学的数学教授Nathaniel Johnston在搜索排列组合问题时，从搜索引擎里看到了这个回答。他稍微注意了一下这个匿名人士的回答，发现他的证明基本上是对的，Johnston稍微整理了一下，把这个证明放在了另一个网站上。但是当时数学家认为这个问题的“正确”答案就是![](http://tex.s2cms.ru/png/%241%21%2B2%21%2B...n%21%24)，所以这个下限就显得没有什么意义，也没有人关心。

但是这次伊根给出新的上限之后，Johnston提醒了公众一下：目前最好的关于超级排列数的下限是2011年在一个动漫论坛上一位匿名人士的一个帖子，这有点像在bilibili的弹幕里隐藏了一个高深的数学证明的感觉。

不管怎样，我们现在有了超级排列数的上限和下限，但两者之间还差了(n-3)!这么大。比如n=6的时候，我们根据下限公式计算应该是867，但是目前找到的最短的是872，还有5的差距。而7的超级排列数就在5884到5908之间等等，所以这个问题远没有解决。
  
你可能会问，我们不能从已发现的超级排列数当中找一下数字的排列规律吗？目前还真没有，虽然一个超级排列序列倒过来肯定也是一个超级排列序列，但似乎没有其他更多规律了。目前已知5的最短超级排列（排除倒过来写的情况）有8种:

----

所有8种长度为153的5的超级排列
 Found by Ben Chaffin in March 2014
123451234152341253412354123145231425314235142315423124531243512431524312543121345213425134215342135421324513241532413524132541321453214352143251432154321
123451234152341253412354123145231425314235142315423124531243512431524312543121354213524135214352134521325413251432513425132451321543215342153241532145321
123451234152341253412354123145231425314235142315421352413521435213452135421534215432154231245321453241532451325413251432513425132453124351243152431254312
123451234152341253412354123145213425134215342135421345214352145321452314253142351423154231245312435124315243125432154325143254132451324153241352413254312
123451234152341253412354132541352413542134521342513421534213541231452314253142351423154231245321435214325143215432145324153245132453124351243152431254312
123451234152341253412354132514325134251324513254135241354213541231452134521435214532154321534215324153214523142531423514231542312453124351243152431254312
123451324513425134521354213524135214352134512341523412534123541231452314253142351423154231245312435124315243125432153421532415321453215432514325413254312
123451324153241352413254132451342513452134512341523412534123541231452314253142351423154213542153421543214532143521432514321542312453124351243152431254312

----

好了，关于超级排列数问题我就介绍到这里。这个问题我感觉有意思的地方它又是一个简单但是数学家不能解决的问题。而且一开始如此有规律的数字，突然在n=6的时候被打断实在太让人吃惊了。而这个问题目前的最佳进展都是业余爱好者给出的，一个是泡动漫二次元论坛的匿名人士，一个是“澳大利亚的刘慈欣”，所以我觉得它应该很适合各位听众去研究。而这个貌似排列组合的问题居然可以转换成图论的“旅行推销员”问题也确实很有趣。我很希望不远的将来，大老李可以在节目里说：中国的某位业余爱好者有了对超级排列数的新发现。

最后，我们可以回答一下最初的那个关于14集的“凉宫春日的忧郁”最快要看多少集可以把所有排列看完的问题：
下限：![](http://tex.s2cms.ru/png/%2414%21%2B13%21%2B12%21%2B11%5Capprox+9.4%5Ctimes+10%5E%7B10%7D%24)
上限：![](http://tex.s2cms.ru/png/%2414%21%2B13%21%2B12%21%2B11%21%2B11%5Capprox+1.9%5Ctimes+10%5E%7B16%7D%24)
因此，这位楼主还是抓紧看第二季吧！好了，下期再见！

----
### 在喜马拉雅FM收听：”大老李聊数学”：

![](https://upload-images.jianshu.io/upload_images/348687-157cd7585d8e4ebc?imageMogr2/auto-orient/strip%7CimageView2/2/w/432)
